    ┌──────────────────────────────────────────────────────────────┐
    │                           USER QUERY                         │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                           WEB UI                             │
    │                  (WebSocket to MCP Client)                   │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                         MCP CLIENT                           │
    │            (forwards to LangGraph agent state)               │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                       INTENT FILTERING                       │
    │              (reduce tools based on query type)              │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                       LANGGRAPH AGENT                        │
    │           (LLM decides tool calls or final answer)           │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    │ if tool needed
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                          ROUTER                              │
    │              (check for tool calls first)                    │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                         TOOLNODE                             │
    │                  (execute MCP tool call)                     │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                       MCP SERVER                             │
    │                  (execute tool function)                     │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    │ if RAG tool
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                     QUERY EMBEDDING                          │
    │               (bge-large → 1024d vector)                     │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                     VECTOR SEARCH                            │
    │           (LanceDB cosine similarity → top-k)                │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                     RETRIEVED CONTEXT                        │
    │               (chunks, metadata, summaries)                  │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                     TOOL RESULT                              │
    │              (returned to LangGraph agent)                   │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                     LLM REASONING                            │
    │              (process results, decide next step)             │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    │ loop or finalize
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                     FINAL ANSWER                             │
    │              (formatted response to user)                    │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                         MCP CLIENT                           │
    │             (stream answer + logs + metrics)                 │
    └───────────────────────────────┬──────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────┐
    │                           WEB UI                             │
    │                    (render to user)                          │
    └──────────────────────────────────────────────────────────────┘

* User → Web UI → Client → Intent Filter → LangGraph → Router → ToolNode → MCP Server → RAG (if needed) → Result → LLM → Final Answer → Client → Web UI